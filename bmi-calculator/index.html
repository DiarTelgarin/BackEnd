<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMI Calculator</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="container">
    <div class="calculator-card">
      <h1>BMI Calculator</h1>
      <p class="subtitle">Calculate your Body Mass Index</p>
      
      <!-- Form for weight and height -->
      <form id="bmiForm">
        <div class="form-group">
          <label for="weight">Weight (kg)</label>
          <input 
            type="number" 
            id="weight" 
            name="weight" 
            step="0.1" 
            placeholder="Enter your weight in kg"
            required>
        </div>
        
        <div class="form-group">
          <label for="height">Height (m)</label>
          <input 
            type="number" 
            id="height" 
            name="height" 
            step="0.01" 
            placeholder="Enter your height in meters"
            required>
        </div>
        
        <button type="submit" class="btn-calculate">Calculate BMI</button>
      </form>
      
      <!-- For result output -->
      <div id="result" style="display: none;">
        <div class="result-section">
          <div class="bmi-value">
            <span class="bmi-number" id="bmiValue"></span>
          </div>
          
          <div class="category-badge" id="categoryBadge"></div>
          
          <div class="details">
            <p><strong>Weight:</strong> <span id="weightDisplay"></span> kg</p>
            <p><strong>Height:</strong> <span id="heightDisplay"></span> m</p>
          </div>
          
          <div class="advice" id="adviceBox"></div>
        </div>
        
        <button class="btn-back" onclick="resetCalculator()">Calculate Again</button>
      </div>
      
      <!-- Categories -->
      <div class="info-section" id="infoSection">
        <h3>BMI Categories:</h3>
        <ul>
          <li><span class="underweight"></span> Underweight: BMI < 18.5</li>
          <li><span class="normal"></span> Normal weight: 18.5 ≤ BMI < 24.9</li>
          <li><span class="overweight"></span> Overweight: 25 ≤ BMI < 29.9</li>
          <li><span class="obese"></span> Obese: BMI ≥ 30</li>
        </ul>
      </div>
    </div>
  </div>
  
  <script>
    const API_URL = 'http://localhost:3000/api/bmi';
    const form = document.getElementById('bmiForm');
    
    // Form submission handler
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const weight = parseFloat(document.getElementById('weight').value);
      const height = parseFloat(document.getElementById('height').value);
      
      // Client-side validation
      if (weight <= 0 || height <= 0) {
        alert('Please enter positive numbers for weight and height!');
        return;
      }
      
      if (height > 3) {
        alert('Height seems too large. Please enter height in meters (e.g., 1.75)');
        return;
      }
      
      // Send data to server
      try {
        const response = await fetch(`${API_URL}/calculate`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ weight, height })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // Render result
          displayResult(data.data);
        } else {
          alert('Error: ' + data.error);
        }
      } catch (error) {
        alert('Failed to connect to server. Make sure the server is running on port 3000.');
        console.error('Error:', error);
      }
    });
    
    function displayResult(data) {
      document.getElementById('bmiValue').textContent = data.bmi;
      document.getElementById('weightDisplay').textContent = data.weight;
      document.getElementById('heightDisplay').textContent = data.height;
      document.getElementById('adviceBox').innerHTML = '<p>' + data.advice + '</p>';
      
      const badge = document.getElementById('categoryBadge');
      badge.textContent = data.category;
      
      // Set badge class based on category
      let categoryClass = '';
      if (data.category === 'Underweight') {
        categoryClass = 'underweight';
      } else if (data.category === 'Normal weight') {
        categoryClass = 'normal';
      } else if (data.category === 'Overweight') {
        categoryClass = 'overweight';
      } else if (data.category === 'Obese') {
        categoryClass = 'obese';
      }
      
      badge.className = 'category-badge ' + categoryClass;
      
      form.style.display = 'none';
      document.getElementById('infoSection').style.display = 'none';
      document.getElementById('result').style.display = 'block';
    }
    
    // Reset calculator
    function resetCalculator() {
      form.style.display = 'block';
      document.getElementById('infoSection').style.display = 'block';
      document.getElementById('result').style.display = 'none';
      form.reset();
    }
  </script>
</body>
</html>